- hosts: localhost
  environment:
    HOMEBREW_GITHUB_TOKEN: "{{ homebrew_github_token }}"
  vars_files:
    - config.default.yml
  vars_prompt:
    - name: homebrew_github_token
      prompt: "Enter a value for HOMEBREW_GITHUB_TOKEN:"
      confirm: true
  pre_tasks:
    - name: Include additional custom configuration
      include_vars: "{{ item }}"
      with_fileglob:
        - config.yml
    - name: Ensure ~/.brewrc file exports HOMEBREW_GITHUB_TOKEN
      lineinfile:
        path: "{{ lookup('env', 'HOME') }}/.brewrc"
        regexp: "^export HOMEBREW_GITHUB_TOKEN="
        line: export HOMEBREW_GITHUB_TOKEN={{ homebrew_github_token }}
        create: true
  roles:
    - role: elliotweiser.osx-command-line-tools
    - role: geerlingguy.mac.homebrew
  tasks:
  post_tasks:
